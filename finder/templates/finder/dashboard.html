<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dashboard ‚Ä¢ Nearify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --primary:#4f46e5; --primary-dark:#4338ca;
      --bg:#f4f6f8; --card:#fff; --muted:#6b7280; --border:#e5e7eb;
      --radius:14px; --shadow:0 10px 24px rgba(0,0,0,.08);
    }
    body{font-family:system-ui;background:var(--bg);margin:0;color:#111}
    .wrap{max-width:980px;margin:28px auto;padding:0 16px}
    .top{display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;margin-bottom:14px}
    .muted{color:var(--muted);font-size:14px}
    a.link{color:var(--primary);text-decoration:none;font-weight:800}
    a.btn{background:var(--primary);color:#fff;padding:10px 12px;border-radius:12px;text-decoration:none;font-weight:900}
    a.btn:hover{background:var(--primary-dark)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}
    .row{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;background:#eef2ff;color:#3730a3;font-weight:800}
    .pill.red{background:#fee2e2;color:#991b1b}
    .pill.gold{background:#fff7cc;color:#8a6b00}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    @media(min-width:720px){.grid{grid-template-columns:1.2fr .8fr}}
    .box{border:1px dashed var(--border);border-radius:14px;padding:12px}
    .img{width:66px;height:66px;border-radius:16px;background:#e5e7eb;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .img img{width:100%;height:100%;object-fit:cover}
    .mini{font-size:12px;color:var(--muted)}
    .btn-sm{border:0;border-radius:12px;padding:9px 12px;font-weight:900;cursor:pointer}
    .btn-sm.gold{background:#fbbf24;color:#111}
    .btn-sm.gray{background:#e5e7eb;color:#111}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="top">
      <div>
        <h2 style="margin:0;">Your Dashboard</h2>
        <div class="muted">Manage your businesses, hours, holiday, images, and promotions.</div>
      </div>
      <div class="row">
        <a class="link" href="/finder/">‚Üê Back to search</a>
        <a class="btn" href="/finder/add/">+ Add business</a>
      </div>
    </div>

    {% for b in my_businesses %}
      <div class="card">
        <div class="row">
          <div style="display:flex; gap:12px; align-items:center;">
            <div class="img">
              {% if b.image %}
                <img src="{{ b.image.url }}" alt="{{ b.name }}">
              {% elif b.image_url %}
                <img src="{{ b.image_url }}" alt="{{ b.name }}">
              {% else %}
                <span class="mini">No image</span>
              {% endif %}
            </div>

            <div>
              <div style="font-weight:1000; font-size:16px;">{{ b.name }}</div>
              <div class="muted">üìç {{ b.location }} ‚Ä¢ {{ b.category }}</div>
              <div class="mini">üïí {{ b.open_time|time:"g:i A" }} - {{ b.close_time|time:"g:i A" }}</div>

              <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
                    {% if b.is_on_holiday %}
                        <span class="pill red">On holiday{% if b.holiday_note %}: {{ b.holiday_note }}{% endif %}</span>
                    {% endif %}

                    {% if b.plan %}
                        {% if b.is_active %}
                        <span class="pill gold">Plan: {{ b.plan|upper }} (ACTIVE)</span>
                        {% if b.featured_until %}
                            <span class="pill">Active until: {{ b.featured_until|date:"M d, Y" }}</span>
                        {% endif %}
                        {% else %}
                        <span class="pill">Plan: {{ b.plan|upper }} (NOT ACTIVE)</span>
                        {% endif %}
                    {% else %}
                        <span class="pill">Plan: FREE</span>    
                    {% endif %}
                </div>

            </div>
          </div>

          <div class="row">
            <a class="link" href="{% url 'business_detail' b.id %}">View</a>
            <a class="btn" href="{% url 'edit_business' b.id %}">Edit</a>
          </div>
        </div>

        <div class="grid">
          <div class="box">
            <div style="font-weight:900;">Holiday</div>
            <div class="mini">One-click toggle (business won‚Äôt show as available when on holiday).</div>

            <form method="post" action="{% url 'toggle_holiday' b.id %}" style="margin-top:10px;">
                {% csrf_token %}

                {% if b.is_on_holiday %}
                    <input type="hidden" name="action" value="off">
                    <button class="btn-sm gray" type="submit">Remove holiday</button>
                {% else %}
                    <input type="hidden" name="action" value="on">
                    <input type="hidden" name="note" value="On hol  iday">
                    <button class="btn-sm gold" type="submit">Set holiday</button>
                {% endif %}
            </form>

          </div>

          <div class="box">
            <div style="font-weight:900;">Analytics</div>
            <div class="mini">Your business performance</div>
            <div style="margin-top:10px; display:grid; gap:6px;">
              <div>üëÄ Views: <b>{{ b.views_count }}</b></div>
              <div>üìû Calls: <b>{{ b.call_clicks }}</b></div>   
              <div>üåê Website: <b>{{ b.website_clicks }}</b></div>
              <div>üß≠ Directions: <b>{{ b.directions_clicks }}</b></div>
            </div>
          </div>
        </div>
      </div>

    {% empty %}
      <div class="card">
        <div class="muted">You don‚Äôt own any businesses yet. Add one to get started.</div>
      </div>
    {% endfor %}

  </div>
</body>
</html>
